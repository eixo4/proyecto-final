{% extends "base.html" %}
{# 
    Este template extiende de 'base.html' para heredar la estructura
    del documento, el Navbar y los scripts necesarios. 
#}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-5 pb-3">
    {# TÍTULO PRINCIPAL #}
    {# Se usa text-white porque el fondo de la página es oscuro (definido en custom.css) #}
    <h2 class="fw-bold text-white">Panel de Administración de Talleres</h2>
    
    {# BOTÓN DE ACCIÓN PRINCIPAL: Crear Nuevo Taller #}
    {# Usa la clase personalizada 'btn-mint' (verde menta) para resaltar #}
    <button class="btn btn-mint shadow" data-bs-toggle="modal" data-bs-target="#createModal">
        <i class="bi bi-plus-lg me-2"></i> Crear Nuevo Taller
    </button>
</div>

{# TABLA DE GESTIÓN DE TALLERES #}
{# El contenedor usa bg-white y sombra para destacarse sobre el fondo #}
<div class="bg-white shadow-sm rounded p-3">
    <table class="table table-striped table-hover">
        <thead class="table-light">
            <tr>
                <th scope="col">Nombre</th>
                <th scope="col">Categoría</th>
                <th scope="col">Fecha y Hora</th>
                <th scope="col">Lugar</th>
                <th scope="col" class="text-center">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {# Bucle de Jinja para iterar sobre la lista de talleres ('workshops') #}
            {% for workshop in workshops %}
            <tr>
                <td class="fw-bold">{{ workshop.name }}</td>
                <td>
                    {# Badge/Etiqueta para la Categoría #}
                    <span class="badge bg-secondary text-white">{{ workshop.category }}</span>
                </td>
                <td>
                    <i class="bi bi-calendar-event me-1 text-muted"></i>{{ workshop.date }}
                    <i class="bi bi-clock ms-2 me-1 text-muted"></i>{{ workshop.time }}
                </td>
                <td>{{ workshop.location }}</td>
                <td class="text-center">
                    {# Botones de Acción (Editar y Eliminar) #}
                    <button class="btn btn-sm btn-outline-secondary me-2" data-bs-toggle="modal" data-bs-target="#editModal{{ workshop.id }}">
                        <i class="bi bi-pencil-fill"></i> Editar
                    </button>
                    <a href="/admin/delete/{{ workshop.id }}" class="btn btn-sm btn-outline-danger" 
                       onclick="return confirm('¿Estás seguro de que quieres eliminar el taller {{ workshop.name }}?')">
                        <i class="bi bi-trash3-fill"></i> Eliminar
                    </a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="text-center text-muted py-4">
                    <i class="bi bi-info-circle me-2"></i> No hay talleres registrados aún.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="modal fade" id="createModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            {# El formulario apunta a la ruta web de Flask para manejar el POST #}
            <form action="/admin/create" method="POST">
                {# Header usa la clase bg-primary para el color de la cabecera (definido en custom.css) #}
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title fw-bold">
                        <i class="bi bi-journal-plus me-2"></i> Registrar Nuevo Taller
                    </h5>
                    {# Botón de cerrar con color blanco para el fondo oscuro #}
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    {# Campo Nombre #}
                    <label for="name-input" class="form-label fw-bold">Nombre del Taller</label>
                    <input type="text" name="name" id="name-input" class="form-control mb-3" placeholder="Nombre del Taller" required>
                    
                    {# Campo Descripción #}
                    <label for="desc-input" class="form-label fw-bold">Descripción (Opcional)</label>
                    <textarea name="description" id="desc-input" class="form-control mb-3" rows="3" placeholder="Breve descripción del contenido..."></textarea>
                    
                    {# Fecha y Hora en una fila #}
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="date-input" class="form-label fw-bold">Fecha</label>
                            <input type="date" name="date" id="date-input" class="form-control" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="time-input" class="form-label fw-bold">Hora</label>
                            <input type="time" name="time" id="time-input" class="form-control" required>
                        </div>
                    </div>

                    {# Lugar #}
                    <label for="location-input" class="form-label fw-bold">Lugar</label>
                    <input type="text" name="location" id="location-input" class="form-control mb-3" placeholder="Lugar (ej: Sala B3)" required>
                    
                    {# Select de Categoría (LISTA EXTENDIDA DE CATEGORÍAS) #}
                    <label for="category-select" class="form-label fw-bold mt-2">Categoría</label>
                    <select name="category" id="category-select" class="form-select mb-3">
                        <option value="Tecnología">Tecnología</option>
                        <option value="Programación">Programación</option> 
                        <option value="Habilidades Blandas">Habilidades Blandas</option>
                        <option value="Negocios">Negocios</option> 
                        <option value="Finanzas">Finanzas</option>
                        <option value="Artes">Artes</option>
                        <option value="Inglés">Inglés</option>
                        <option value="Electricidad / Electrónica">Electricidad / Electrónica</option>
                        <option value="Hotelería / Turismo">Hotelería / Turismo</option>
                        <option value="Química">Química</option>
                    </select>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    {# Botón de envío que usa la clase personalizada 'btn-mint' #}
                    <button type="submit" class="btn btn-mint">Guardar Taller</button>
                </div>
            </form>
        </div>
    </div>
</div>


{% for workshop in workshops %}
<div class="modal fade" id="editModal{{ workshop.id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            {# El formulario apunta a la ruta web de Flask para editar #}
            <form action="/admin/edit/{{ workshop.id }}" method="POST">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title fw-bold">
                        <i class="bi bi-pencil-square me-2"></i> Editar Taller: {{ workshop.name }}
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    {# Campo Nombre #}
                    <label class="form-label fw-bold">Nombre del Taller</label>
                    <input type="text" name="name" class="form-control mb-3" value="{{ workshop.name }}" required>
                    
                    {# Campo Descripción #}
                    <label class="form-label fw-bold">Descripción (Opcional)</label>
                    <textarea name="description" class="form-control mb-3" rows="3">{{ workshop.description }}</textarea>
                    
                    {# Fecha y Hora en una fila #}
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">Fecha</label>
                            <input type="date" name="date" class="form-control" value="{{ workshop.date }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">Hora</label>
                            <input type="time" name="time" class="form-control" value="{{ workshop.time }}" required>
                        </div>
                    </div>

                    {# Lugar #}
                    <label class="form-label fw-bold">Lugar</label>
                    <input type="text" name="location" class="form-control mb-3" value="{{ workshop.location }}" required>
                    
                    {# Select de Categoría CON VALOR PRE-SELECCIONADO #}
                    <label class="form-label fw-bold mt-2">Categoría</label>
                    <select name="category" class="form-select mb-3">
                        <option value="Tecnología" {% if workshop.category == 'Tecnología' %}selected{% endif %}>Tecnología</option>
                        <option value="Programación" {% if workshop.category == 'Programación' %}selected{% endif %}>Programación</option> 
                        <option value="Habilidades Blandas" {% if workshop.category == 'Habilidades Blandas' %}selected{% endif %}>Habilidades Blandas</option>
                        <option value="Negocios" {% if workshop.category == 'Negocios' %}selected{% endif %}>Negocios</option> 
                        <option value="Finanzas" {% if workshop.category == 'Finanzas' %}selected{% endif %}>Finanzas</option>
                        <option value="Artes" {% if workshop.category == 'Artes' %}selected{% endif %}>Artes</option>
                        <option value="Inglés" {% if workshop.category == 'Inglés' %}selected{% endif %}>Inglés</option>
                        <option value="Electricidad / Electrónica" {% if workshop.category == 'Electricidad / Electrónica' %}selected{% endif %}>Electricidad / Electrónica</option>
                        <option value="Hotelería / Turismo" {% if workshop.category == 'Hotelería / Turismo' %}selected{% endif %}>Hotelería / Turismo</option>
                        <option value="Química" {% if workshop.category == 'Química' %}selected{% endif %}>Química</option>
                    </select>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-mint">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}
{% endblock %}
